// version 4.9 (2014-03-26)

//var totalFeatures = 0; 
var firstTimerLength = 4000; // time from start to first rotation, or mouseout to rotation.
var nextTimerLength = 6000;  // time between rotations when no mouse interaction.

//var cID = 1;
//var featureTimer = null;
//var runningFeatureSlideshow = true;
//var overridePause = false;


fs = new Array();
fsnames = ["rotating", "rotating-2", "vertical", "vertical-w", "ticker"];

for (i = 0 ; i < fsnames.length; i++) {
    fs[fsnames[i]] = [0, 1, null, true, false];    
    // [totalFeatures, current, timer, running, overridePause]
}


$anujq(document).ready(function() {

    protosrc = (document.location.protocol == 'https:' ? 'https:' : 'http:');
                                       
    for (i = 0 ; i < fsnames.length; i++) {
            fs[fsnames[i]][0] = $anujq('#anu-features-' + fsnames[i] + ' .feature-box').length;

            $anujq('#anu-features-' + fsnames[i] + ' .feature-box').hide();
            $anujq('#anu-features-' + fsnames[i] + ' .feature-box').eq(fs[fsnames[i]][1] - 1).show();
            $anujq('#features-nav-' + fsnames[i]).css('zIndex', 15);
                       
    }

    for (i = 0 ; i < fsnames.length; i++) {       
                       
                       if (supports_html5_storage() && localStorage["anu-features-paused" + fsnames[i]] == "true") {
        
                            fs[fsnames[i]][4] = true;
                            fs[fsnames[i]][3] = false;
                       
                            $anujq('#features-nav-' + fsnames[i] + ' #anu-feature-playpause').attr('alt', 'Play');
                            $anujq('#features-nav-' + fsnames[i] + ' #anu-feature-playpause').attr('title', 'Play');
                            $anujq('#features-nav-' + fsnames[i] + ' #anu-feature-playpause').attr('src',  protosrc + '//style.anu.edu.au/_anu/images/icons/play2.png');
                  
                       $anujq('#features-nav-' + fsnames[i] + ' .anu-feature-playpause').attr('alt', 'Play');
                       $anujq('#features-nav-' + fsnames[i] + ' .anu-feature-playpause').attr('title', 'Play');
                       $anujq('#features-nav-' + fsnames[i] + ' .anu-feature-playpause').attr('src',  protosrc + '//style.anu.edu.au/_anu/images/icons/play2.png');

                       
                       } else { 
     
                           if (fs[fsnames[i]][0] > 0) {				   
					         playFeatureTimer(fsnames[i]);		
                           }
                           else {
                             fs[fsnames[i]][3] = true;
                             fs[fsnames[i]][4] = false;
                           }
                       }
    }
});



function showNextFeature(fname) {
	    
    if (!fname) { fname = "rotating"; }
    
	if (fs[fname][1] >= fs[fname][0]) {
		showFeature(1,fname);
	}
	else {
        showFeature(fs[fname][1]+1,fname);
	}
	
	if (fs[fname][3]) {
        fs[fname][2] = setTimeout(function() {showNextFeature(fname)},nextTimerLength);
	}
	
}

function showPrevFeature(fname) {
    
    if (!fname) { fname = "rotating"; }
    
	if (fs[fname][1] <= 0) {
		showFeature(fs[fname][0] - 1,fname);
	}
	else {
        showFeature(fs[fname][1]-1,fname);
	}
	
	if (fs[fname][3]) {
        fs[fname][2] = setTimeout(function() {showNextFeature(fname)},nextTimerLength);
	}
	
}

function supports_html5_storage() {
    try {
        return 'localStorage' in window && window['localStorage'] !== null;
    } catch (e) {
        return false;
    }
}

 
 
function pausePlayFeatures(fname) {
    
    protosrc = (document.location.protocol == 'https:' ? 'https:' : 'http:');
    
    if (!fname) { fname = "rotating"; }
    
	if (fs[fname][4] == false) {
		fs[fname][4] = true;
		pauseFeatureTimer(fname);
        
            $anujq('#features-nav-' + fname + ' #anu-feature-playpause').attr('alt', 'Play');
            $anujq('#features-nav-' + fname + ' #anu-feature-playpause').attr('title', 'Play');
            $anujq('#features-nav-' + fname + ' #anu-feature-playpause').attr('src', protosrc + '//style.anu.edu.au/_anu/images/icons/play2.png');

        $anujq('#features-nav-' + fname + ' .anu-feature-playpause').attr('alt', 'Play');
        $anujq('#features-nav-' + fname + ' .anu-feature-playpause').attr('title', 'Play');
        $anujq('#features-nav-' + fname + ' .anu-feature-playpause').attr('src', protosrc + '//style.anu.edu.au/_anu/images/icons/play2.png');
       

        if (supports_html5_storage()){
            localStorage["anu-features-paused" + fname] = "true";
        } 
    }
	else {
		fs[fname][4] = false;
		playFeatureTimerImmediate(fname);

       
            $anujq('#features-nav-' + fname + ' #anu-feature-playpause').attr('alt', 'Pause');
            $anujq('#features-nav-' + fname + ' #anu-feature-playpause').attr('title', 'Pause');
            $anujq('#features-nav-' + fname + ' #anu-feature-playpause').attr('src', protosrc + '//style.anu.edu.au/_anu/images/icons/pause2.png');

        $anujq('#features-nav-' + fname + ' .anu-feature-playpause').attr('alt', 'Pause');
        $anujq('#features-nav-' + fname + ' .anu-feature-playpause').attr('title', 'Pause');
        $anujq('#features-nav-' + fname + ' .anu-feature-playpause').attr('src', protosrc + '//style.anu.edu.au/_anu/images/icons/pause2.png');

        
        if (supports_html5_storage()){
            localStorage.removeItem("anu-features-paused" + fname);
        }
    }
	
}

function pauseFeatureTimer(fname) {
   
    if (!fname) { fname = "rotating"; }
    
    fs[fname][3] = false;
	clearTimeout(fs[fname][2]);
}



function playFeatureTimerImmediate(fname) {

    if (!fname) { fname = "rotating"; }
    
    if (fs[fname][4] == false) {
		fs[fname][2] = setTimeout(function() {showNextFeature(fname)},200);
		fs[fname][3] = true;
	}
}

function playFeatureTimer(fname) {
	    
    if (!fname) { fname = "rotating"; }
    
    if (fs[fname][4] == false) {
		fs[fname][2] = setTimeout(function() {showNextFeature(fname)},firstTimerLength);
		fs[fname][3] = true;
	}
}

function showFeature(newID,fname) {
	
    if (!fname) { fname = "rotating"; }
    
    clearTimeout(fs[fname][2]);
	
	if (fs[fname][1] == parseInt(newID)) {
		return;
	}
	
	fadeFeature2Feature(newID,fname);
} 

function fadeFeature2Feature(newID,fname) {

    if (!fname) { fname = "rotating"; }
 
	// set all the nav boxes to unhighlighted
	$anujq("#features-nav-" + fname + " ul li a").removeClass('linkselect');									   

    
    // put the current image on top, new one underneath, and fade out the old one 
	$anujq('#anu-features-' + fname + ' .feature-box').eq(fs[fname][1] - 1).css('zIndex', 10)
	$anujq('#anu-features-' + fname + ' .feature-box').eq(newID - 1).css('zIndex', 5);
	
	//Remove following line if you want fade to white
	$anujq('#anu-features-' + fname + ' .feature-box').eq(newID - 1).show();
	
	// 'fast', function()...
	$anujq('#anu-features-' + fname + ' .feature-box').eq(fs[fname][1] - 1).stop(true,false).fadeOut( function() {

		// once the fade out is done, hide the old image, and set new nav box to highlighted.
		$anujq(this).hide();

	    $anujq("#features-nav-" + fname + " ul li a").removeClass('linkselect');									   

	// Add following line for fade to white.															
	//	$anujq('.feature-box').eq(newID - 1).stop(true,false).fadeIn('fast', function() {														
	    $anujq("#features-nav-" + fname + " #feature-link-"+newID).addClass('linkselect');
        $anujq("#features-nav-" + fname + " .plinkselect").eq(newID - 1).addClass('linkselect');

                                                                                                     
		fs[fname][1] = parseInt(newID);

		// Add following line for fade to white.															
	    //			});
		});
    
}
 
 
